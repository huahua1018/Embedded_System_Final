C51 COMPILER V7.08   FINAL_PROJECT                                                         05/30/2023 04:27:23 PAGE 1   


C51 COMPILER V7.08, COMPILATION OF MODULE FINAL_PROJECT
OBJECT MODULE PLACED IN final_project.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE final_project.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*-----------------------------------------------
   2          ´Á¥½±MÃD
   3          ------------------------------------------------*/
   4          #include<reg52.h> //¥]§t¼ÐÀYÀÉ¡A¤@¯ë±¡ªp¤£»Ý­n§ï°Ê¡A¼ÐÀYÀÉ¥]§t¯S®í¥\¯à±H¦s¾¹ªº©w¸q 
   5          #include <intrins.h>
   6          #include "uart.h"
   7          #include "eeprom.h"
   8          #include "delay.h"
   9          
  10          //ª¬ºA
  11          #define Error   '1'
  12          #define Win             '2'
  13          #define Loss    '3'
  14          #define Wrong   '4'
  15          #define Start   '5'
  16          #define Time    '6'
  17          #define Login   '7'
  18          #define Logout '8'
  19          
  20          #define UP              16
  21          #define DOWN    17
  22          #define CLEAN   18
  23          #define ENTER   19
  24          
  25          #define ACCOUNT 0
  26          #define GUESS   1
  27          #define RESULT  2
  28          #define RECODRD 3
  29          
  30          #define DataPort P0 //©w¸q¸ê®Æ°ð 
  31          #define KeyPort P1      //©w¸qÁä½L°ð
  32          
  33          sbit SPK   =P2^0;  //©w¸q­µ¼Ö¿é¥X°ð
  34          sbit LATCH1=P3^7;       //©w¸qÂê¦s¨Ï¯à°ð ¬qÂê¦s
  35          sbit LATCH2=P3^6;       //               ¦ìÂê¦s
  36          
  37          /*LED¿O¥Nªí³Ñ¾l²q´ú¾÷·|*/
  38          sbit LED1 = P2^7;
  39          sbit LED2 = P2^6;
  40          sbit LED3 = P2^5;
  41          sbit LED4 = P2^4;
  42          sbit LED5 = P2^3;
  43          
  44          sbit Logout_but = P2^2; //µn¥XÁä
  45          
  46          /*¤C¬qÅã¥Ü¾¹¬ÛÃö³]©w*/                     
  47          unsigned char code dofly_DuanMa[] = {0x3f, 0x06, 0x5b, 0x4f, 0x66, 0x6d, 0x7d, 0x07, 0x7f, 0x6f,0x77,0x7c,
             -0x40,0x00}; // Åã¥Ü¬q½X­È0~9¡BA¡Bb¡B-¡B¥þ¶Â
  48          unsigned char code dofly_WeiMa[] = {0xfe, 0xfd, 0xfb, 0xf7, 0xef, 0xdf, 0xbf, 0x7f};                // ¤À§
             -O¹ïÀ³¬ÛÀ³ªº¼Æ½XºÞÂI«G,§Y¦ì½X
  49          unsigned char TempData[8];  // ¦sÀxÅã¥Ü­Èªº¥þ°ìÅÜ¼Æ
  50          unsigned char show_result_flag = 0;     //²{¦b¬O§_Åã¥Ü²q´úµ²ªG
  51          
  52          unsigned char Timer0_H,Timer0_L,Time_delay;
  53          unsigned char play_music=0;
C51 COMPILER V7.08   FINAL_PROJECT                                                         05/30/2023 04:27:23 PAGE 2   

  54          
  55          /*³â¥z¬ÛÃö³]©w*/  
  56          //­µ¶¥(do,re,mi...),­µ°ª(²Ä´X¦C),¸`©ç
  57          code unsigned char win_music[]={    1,2,1,      2,2,1,  3,2,1,  6,2,2,  5,2,2,  6,2,2,   };
  58          code unsigned char error_music[]={  1,0,1,      1,0,1,};
  59          code unsigned char wrong_music[]={  6,0,2,      4,0,2,};
  60          code unsigned char logout_music[]={  6,2,1,     4,2,1,};
  61          code unsigned char login_music[]={  4,2,1,      6,2,1,};
  62          code unsigned char loss_music[]={   4,0,3,      3,0,3,  2,0,3, 1,0,3,};
  63          code unsigned char start_music[]={   1,1,1,     2,1,1,  3,1,1, 4,1,1,};
  64          //1,2,3,4,5,6,7(do,re,mi...)
  65          //­µ¶¥ÀW²vªí °ª¤K¦ì¤¸                     
  66          code unsigned char FREQH[]={    
  67                                          0xF2,0xF3,0xF5,0xF5,0xF6,0xF7,0xF8, 
  68                                          0xF9,0xF9,0xFA,0xFA,0xFB,0xFB,0xFC,
  69                                          0xFC,0xFC,0xFD,0xFD,0xFD,0xFD,0xFE,
  70                                          0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFF,
  71                                         } ;
  72          //­µ¶¥ÀW²vªí §C¤K¦ì¤¸                         
  73          code unsigned char FREQL[]={    
  74                                           0x42,0xC1,0x17,0xB6,0xD0,0xD1,0xB6,
  75                                           0x21,0xE1,0x8C,0xD8,0x68,0xE9,0x5B, 
  76                                           0x8F,0xEE,0x44, 0x6B,0xB4,0xF4,0x2D, 
  77                                           0x47,0x77,0xA2,0xB6,0xDA,0xFA,0x16,
  78                                          };
  79          /*¹CÀ¸°Ñ¼Æ¬ÛÃö³]©w*/
  80          //±b¸¹¡A³Ì«á¤@­Ó¬°Àx¦s¤ÎÅª¨ú®É©ñ¤Jª¬ºA¥Î
  81          unsigned char myaccount[9]={'0','0','0','0','0','0','0','0',Logout};  
  82          unsigned char state;                    //±b¸¹ª¬ºA(Login/Logout)
  83          unsigned char enter_account[8]; //¥Ø«e¬°¤î¿é¤Jªº±b¸¹
  84          unsigned char enter_guess[5];   //¥Ø«e¬°¤î¿é¤Jªº²q´ú¼Æ¦r
  85          unsigned char enter_cnt=0;              //¥Ø«e¬°¤î¿é¤J¤F´X­Ó
  86          unsigned char display_num = 0;  //Åã¥Ü 0:®É¶¡|·í«e²q´ú/µ²ªG 1~4:record
  87          unsigned char record_cnt = 0;   //´X­Ó²q´ú¬ö¿ý
  88          unsigned int  game_time = 300;  
  89          unsigned char game_start = 0;   //¹CÀ¸¬O§_¶}©l
  90          unsigned char record_arr[4][8]; //¦s©ñ²q´ú©Mµ²ªG¬ö¿ýªº°}¦C
  91          
  92          //16 keyboard¬ÛÃöªº¨ç¦¡«Å§i
  93          unsigned char KeyScan(void);
  94          unsigned char KeyPro(void);
  95          
  96          /*------------------------------------------------
  97           Åã¥Ü¨ç¼Æ¡A¥Î©ó°ÊºA±½´y¼Æ½XºÞ
  98           ¿é¤J°Ñ¼Æ FirstBit ªí¥Ü»Ý­nÅã¥Üªº²Ä¤@¦ì¡A¦p½á­È2ªí¥Ü±q²Ä¤T­Ó¼Æ½XºÞ¶}©lÅã¥Ü
  99           ¦p¿é¤J0ªí¥Ü±q²Ä¤@­ÓÅã¥Ü¡C
 100           Numªí¥Ü»Ý­nÅã¥Üªº¦ì¤¸¤¸¼Æ¡A¦p»Ý­nÅã¥Ü99¨â¦ì¤¸¤¸¼Æ­È«h¸Ó­È¿é¤J2
 101          ------------------------------------------------*/
 102          void Display(unsigned char FirstBit, unsigned char Num)
 103          {
 104   1          static unsigned char i = 0;
 105   1      
 106   1          DataPort = 0; // ²MªÅ¸ê®Æ¡A¨¾¤î¦³¥æ´À­«¼v
 107   1          LATCH1 = 1;   // ¬qÂê¦s
 108   1          LATCH1 = 0;
 109   1      
 110   1          DataPort = dofly_WeiMa[i + FirstBit]; // ¨ú¦ì½X
 111   1          LATCH2 = 1;                           // ¦ìÂê¦s
 112   1          LATCH2 = 0;
 113   1      
 114   1          DataPort = TempData[i]; // ¨úÅã¥Ü¸ê®Æ¡A¬q½X
 115   1          LATCH1 = 1;             // ¬qÂê¦s
C51 COMPILER V7.08   FINAL_PROJECT                                                         05/30/2023 04:27:23 PAGE 3   

 116   1          LATCH1 = 0;
 117   1      
 118   1          i++;
 119   1          if (i == Num)
 120   1              i = 0;
 121   1      }
 122          
 123          /*------------------------------------------------
 124                          ®Ú¾Úª¬ºA¨M©wÅã¥Ü¦b¤C¬qÅã¥Ü¾¹¤Wªº¤º®e
 125          ------------------------------------------------*/
 126          void display_set()
 127          {
 128   1              unsigned char i;
 129   1              //­Y«D¹CÀ¸¶i¦æ¤¤ªºª¬ºA
 130   1              if(!game_start) 
 131   1              {
 132   2                      //­Y¬°µn¥Xª¬ºA¡A«h«ö¤Uªº¼Æ¦r·|Åã¥Ü¡AÁÙ¥¼«ö¨ìªº³¡¤ÀÅã¥Ü'-'
 133   2                      if(state==Logout)
 134   2                      {
 135   3                              for(i=0;i<enter_cnt;i++)
 136   3                                      TempData[i]=dofly_DuanMa[enter_account[i]-'0'];
 137   3                              for(i=enter_cnt;i<8;i++)                
 138   3                                      TempData[i]=dofly_DuanMa[12];
 139   3                      }
 140   2                      //­Y¬°µn¤Jª¬ºA¡A«hÅã¥Ü±b¸¹
 141   2                      else
 142   2                      {
 143   3                              for(i=0;i<8;i++)
 144   3                                      TempData[i]=dofly_DuanMa[myaccount[i]-'0'];
 145   3                      }
 146   2              }
 147   1              //­Y¬°¹CÀ¸¶i¦æ¤¤¡A«h®Ú¾Údisplay_num¨Ó±±¨îÅã¥Üªº³¡¤À
 148   1              else
 149   1              {
 150   2                      //Åã¥Ü®É¶¡ ©M ·í«e²q´ú/µ²ªG
 151   2                      if(display_num==0)
 152   2                      {
 153   3                              TempData[0]=dofly_DuanMa[game_time/100];
 154   3                              TempData[1]=dofly_DuanMa[(game_time/10)%10];
 155   3                              TempData[2]=dofly_DuanMa[game_time%10];
 156   3                              TempData[3]=0x00;
 157   3                              //­Y¦¬¨ì²q´úµ²ªG«hÅã¥Üµ²ªG
 158   3                              if(show_result_flag)
 159   3                              {
 160   4                                      for(i=4;i<8;i++)
 161   4                                              TempData[i]=dofly_DuanMa[result_buf[i-4]];
 162   4                              }
 163   3                              //§_«hÅã¥Ü¿é¤Jªº²q´ú
 164   3                              else
 165   3                              {
 166   4                                      //ÁÙ¥¼¿é¤Jªº³¡¤ÀÅã¥Ü¥þ¶Â
 167   4                                      for(i=4;i<4+enter_cnt;i++)
 168   4                                              TempData[i]=dofly_DuanMa[enter_guess[i-4]-'0'];
 169   4                                      for(;i<8;i++)
 170   4                                              TempData[i] = 0x00;
 171   4                              }       
 172   3                      }
 173   2                      //Åã¥Ü¹L¥h²q´ú©Mµ²ªGªº¬ö¿ý
 174   2                      else
 175   2                      {
 176   3                              for(i=0;i<8;i++)
 177   3                                      TempData[i]=dofly_DuanMa[record_arr[display_num-1][i]];
C51 COMPILER V7.08   FINAL_PROJECT                                                         05/30/2023 04:27:23 PAGE 4   

 178   3                      }
 179   2              }
 180   1      }   
 181          
 182          /*------------------------------------------------
 183                        ­p®É¾¹ªì©l¤Æ°Æµ{¦¡
 184          ------------------------------------------------*/
 185          void Init_Timer0(void)
 186          {
 187   1              TMOD |= 0x01;     //¨Ï¥Î¼Ò¦¡1¡A16¦ì¤¸­p®É¾¹¡A¨Ï¥Î"|"²Å¸¹¥i¥H¦b¨Ï¥Î¦h­Ó­p®É¾¹®É¤£¨ü¼vÅT               
 188   1              EA=1;            //Á`¤¤Â_¥´¶}
 189   1              ET0=1;           //­p®É¾¹¤¤Â_¥´¶}
 190   1              TR0=1;           //­p®É¾¹¶}Ãö¥´¶}
 191   1      }
 192          
 193          /*------------------------------------------------
 194              ­p®É¾¹¤¤Â_°Æµ{¦¡--¦b¦¹¥Î¨Ó¼½©ñ­µ¼Ö©M¤C¬qÅã¥Ü¾¹
 195          ------------------------------------------------*/
 196          void Timer0_isr(void) interrupt 1 
 197          {       
 198   1              Display(0,8);   //½Õ¥Î¼Æ½XºÞ±½´y
 199   1              
 200   1              //­Y·í«e¬O¦b¼½©ñ­µ¼Ö
 201   1              if(play_music)          
 202   1              {
 203   2                      SPK=!SPK;
 204   2                      //®Ú¾Ú¼½©ñªº­µ¼Ö³]©wªº©ç¤l¨Ó½Õ¾ã
 205   2                      TH0=Timer0_H;
 206   2                      TL0=Timer0_L;
 207   2              }
 208   1              else
 209   1              {
 210   2                      //§_«h­«·s½á­È1ms
 211   2                      TH0=(65536-1000)/256;            
 212   2                      TL0=(65536-1000)%256;
 213   2              }
 214   1      }
 215           
 216          /*------------------------------------------------
 217                          ¸`©ç©µ®É¨ç¼Æ
 218           ¦U½Õ1/4¸`©ç®É¶¡¡G
 219           ½Õ4/4  125ms
 220           ½Õ2/4  250ms
 221           ½Õ3/4  187ms
 222          ------------------------------------------------*/
 223          void delay(unsigned char t)
 224          {
 225   1          unsigned char i;
 226   1              for(i=0;i<t;i++)
 227   1                  DelayMs(100);
 228   1          TR0=0;
 229   1       }
 230          
 231          /*------------------------------------------------
 232                                          ºq¦±³B²z¨ç¼Æ
 233          ------------------------------------------------*/
 234          void Song()
 235          {
 236   1              TH0=Timer0_H;//½á­È­p®É¾¹®É¶¡¡A¨M©wÀW²v                                              
 237   1              TL0=Timer0_L;
 238   1              TR0=1;       //¥´¶}­p®É¾¹
 239   1              delay(Time_delay); //©µ®É©Ò»Ý­nªº¸`©ç(³o¬q´Á¶¡¨C·í¼Æ¨ì³]©wªº¼Æ¡A³£·|±Ò°Êinterrupt¡Aµo¥X­µ¶¥)
C51 COMPILER V7.08   FINAL_PROJECT                                                         05/30/2023 04:27:23 PAGE 5   

 240   1      }
 241          
 242          /*------------------------------------------------
 243                   ®Ú¾Ú¤£¦P±¡ªp¼½©ñ¤£¦P­µ®Äªº¨ç¦¡
 244          ------------------------------------------------*/
 245          void play_song(unsigned char mode)
 246          {
 247   1              unsigned char i=0,k;
 248   1              play_music=1;   //³]©w·í«e¦b¼½©ñ­µ¼Ö
 249   1              if(mode==Win)
 250   1              {
 251   2                      while(i<18)
 252   2                      {              
 253   3                              k=win_music[i]+7*win_music[i+1]-1;
 254   3                              Timer0_H=FREQH[k];
 255   3                              Timer0_L=FREQL[k];
 256   3                              Time_delay=win_music[i+2];
 257   3                              i=i+3;
 258   3                              Song();
 259   3              } 
 260   2      
 261   2              }
 262   1              else if(mode==Wrong)
 263   1              {
 264   2                      while(i<6)
 265   2                      {              
 266   3                              k=wrong_music[i]+7*wrong_music[i+1]-1;
 267   3                              Timer0_H=FREQH[k];
 268   3                              Timer0_L=FREQL[k];
 269   3                              Time_delay=wrong_music[i+2]; 
 270   3                              i=i+3;
 271   3                              Song();
 272   3              } 
 273   2              }
 274   1              else if(mode==Error)
 275   1              {
 276   2                      while(i<6)
 277   2                      {              
 278   3                              k=error_music[i]+7*error_music[i+1]-1;
 279   3                              Timer0_H=FREQH[k];
 280   3                              Timer0_L=FREQL[k];
 281   3                              Time_delay=error_music[i+2];   
 282   3                              i=i+3;
 283   3                              Song();
 284   3              } 
 285   2              }
 286   1              else if(mode==Loss)
 287   1              {
 288   2                      while(i<12)
 289   2                      {             
 290   3                              k=loss_music[i]+7*loss_music[i+1]-1;
 291   3                              Timer0_H=FREQH[k];
 292   3                              Timer0_L=FREQL[k];
 293   3                              Time_delay=loss_music[i+2]; 
 294   3                              i=i+3;
 295   3                              Song();
 296   3              } 
 297   2              }
 298   1              else if(mode==Start)
 299   1              {
 300   2                      while(i<12)
 301   2                      {        
C51 COMPILER V7.08   FINAL_PROJECT                                                         05/30/2023 04:27:23 PAGE 6   

 302   3                              k=start_music[i]+7*start_music[i+1]-1;
 303   3                              Timer0_H=FREQH[k];
 304   3                              Timer0_L=FREQL[k];
 305   3                              Time_delay=start_music[i+2]; 
 306   3                              i=i+3;
 307   3                              Song();
 308   3              } 
 309   2              }
 310   1              else if(mode==Login)
 311   1              {
 312   2                      while(i<6)
 313   2                      {     
 314   3                              k=login_music[i]+7*login_music[i+1]-1;
 315   3                              Timer0_H=FREQH[k];
 316   3                              Timer0_L=FREQL[k];
 317   3                              Time_delay=login_music[i+2]; 
 318   3                              i=i+3;
 319   3                              Song();
 320   3              } 
 321   2              }
 322   1              else    //logout
 323   1              {
 324   2                      while(i<6)
 325   2                      {       
 326   3                              k=logout_music[i]+7*logout_music[i+1]-1;
 327   3                              Timer0_H=FREQH[k];
 328   3                              Timer0_L=FREQL[k];
 329   3                              Time_delay=logout_music[i+2]; 
 330   3                              i=i+3;
 331   3                              Song();
 332   3              } 
 333   2              }
 334   1              play_music=0;           //¨ú®ø¥¿¦b¼½©ñ­µ¼Öªºflag
 335   1              TH0=(65536-1000)/256; //­«·s½á­È 1ms
 336   1              TL0=(65536-1000)%256;
 337   1              TR0=1;       //¥´¶}­p®É¾¹
 338   1      } 
 339          
 340          /*------------------------------------------------
 341                      ²q¿ù¤@¦¸Ãö³¬¤@­Ó¿Oªº¨ç¦¡
 342          ------------------------------------------------*/
 343          void led_close()
 344          {
 345   1              switch(5-record_cnt)
 346   1              {
 347   2                      case 0:
 348   2                              LED1 = 1;
 349   2                              break;
 350   2                      case 1:
 351   2                              LED2 = 1;
 352   2                              break;
 353   2                      case 2:
 354   2                              LED3 = 1;
 355   2                              break;
 356   2                      case 3:
 357   2                              LED4 = 1;
 358   2                              break;
 359   2                      case 4:
 360   2                              LED5 = 1;
 361   2                              break;
 362   2      
 363   2              }
C51 COMPILER V7.08   FINAL_PROJECT                                                         05/30/2023 04:27:23 PAGE 7   

 364   1      }
 365          
 366          /*------------------------------------------------
 367                      Ãö³¬/¶}±Ò©Ò¦³¿Oªº¨ç¦¡
 368          ------------------------------------------------*/
 369          void led_all(unsigned char val)
 370          {
 371   1              LED1 = val;
 372   1              LED2 = val;
 373   1              LED3 = val;
 374   1              LED4 = val;
 375   1              LED5 = val;
 376   1      }
 377          
 378          /*------------------------------------------------
 379                    ³B²z¹CÀ¸µ²§ô¤Îªì©l¤Æªº¨ç¦¡
 380          ------------------------------------------------*/
 381          void game_end_init()
 382          {
 383   1              /*ªì©l¤Æ©M¹CÀ¸¬ÛÃöªº°Ñ¼Æ*/
 384   1              led_all(1);     //Ãö³¬©Ò¦³led
 385   1              enter_cnt = 0;
 386   1              record_cnt = 0;
 387   1              game_start = 0;
 388   1              display_num = 0;
 389   1              show_result_flag = 0;
 390   1              result_flag = 0;
 391   1              game_time = 300;
 392   1              
 393   1              /*­Y·í«e¬°µn¤Jª¬ºA«h¦Û°Ê¦^¶Çª±®a¤@±b¸¹*/
 394   1              if(state==Login)
 395   1              {
 396   2                      UART_SendStr("account\n");
 397   2                      myaccount[8]='\n';
 398   2                      UART_SendStr(myaccount);
 399   2              }
 400   1      }  
 401          
 402          /*------------------------------------------------
 403                              ¥D¨ç¼Æ
 404          ------------------------------------------------*/
 405          void main (void)
 406          {
 407   1              unsigned char i;
 408   1              unsigned char mynum;
 409   1              unsigned char ck_btn;
 410   1      
 411   1              Init_Timer0();
 412   1              InitUART();
 413   1              ES    = 1;                  //¥´¶}¦ê¤f¤¤Â_(¤~¯à±µ¦¬)
 414   1              IRcvStr(0xae,4,&myaccount,9);   //½Õ¥Î¦sÀx¸ê®Æ
 415   1              state=myaccount[8];                             //«e¤C¦ì¬°±b¸¹¡A³Ì«á¤@¦ì¬°ª¬ºA
 416   1              
 417   1              /*­Y¬°µn¤Jª¬ºA¡A«hª½±µ¶Ç°eª±®a¤@±b¸¹*/
 418   1              if(state==Login)
 419   1              {
 420   2                      UART_SendStr("account\n");
 421   2                      myaccount[8]='\n';
 422   2                      UART_SendStr(myaccount);
 423   2                      //¼½©ñµn¤J­µ®Ä
 424   2                      play_song(state);
 425   2                      //¤C¬qÅã¥Ü¾¹Åã¥Ü±b¸¹
C51 COMPILER V7.08   FINAL_PROJECT                                                         05/30/2023 04:27:23 PAGE 8   

 426   2                      for(i=0;i<8;i++)        //²MªÅ
 427   2                              TempData[i]=0x00;
 428   2                      for(i=0;i<8;i++)        //Àx¦s¤w¿é¤Jªº­È¹ïÀ³ªº¬q½X
 429   2                              TempData[i]=dofly_DuanMa[myaccount[i]-'0'];
 430   2              }
 431   1      
 432   1              while (1)                       
 433   1          {
 434   2      
 435   2                      mynum = KeyPro();
 436   2                      if(mynum != 0xff)               //ÀË¬d¬O§_«ö¤U¦³®ÄÁä
 437   2                      {
 438   3                              if(mynum==ENTER)        //­Y«ö¤Uªº¬Oenter
 439   3                              {
 440   4                                      /*­Y·í«e¬°µn¥Xª¬ºA¡A¥B¤w«ö¤F8­Ó¸¹½X*/
 441   4                                      if(state==Logout&&enter_cnt==8)
 442   4                                      {
 443   5                                              //³]©w¬°ª±®a¤@ªº±b¸¹
 444   5                                              for(i=0;i<8;i++)
 445   5                                                      myaccount[i]=enter_account[i];
 446   5                                              //ª¬ºA¬°µn¤J
 447   5                                              state=Login;
 448   5                                              myaccount[8]=state;
 449   5                                              //Àx¦s¨ìEEPROM
 450   5                                              ISendStr(0xae,4,&myaccount,9);
 451   5                                              myaccount[8]='\n';
 452   5                                              //¶Ç°e±b¸¹µ¹ESP32
 453   5                                              UART_SendStr("account\n");
 454   5                                              UART_SendStr(myaccount);
 455   5                                              //¼½©ñµn¤J­µ®Ä
 456   5                                              play_song(state);
 457   5                                      }
 458   4                                      /*­Y·í«e¤w¦b¹CÀ¸¶i¦æ¤¤¡A¥B¤w«ö¤F4­Ó¸¹½X*/
 459   4                                      else if(game_start&&enter_cnt==4)
 460   4                                      {
 461   5                                              /*¶Ç°e²q´ú*/
 462   5                                              UART_SendStr("guess\n");
 463   5                                              enter_guess[4]='\n';
 464   5                                              UART_SendStr(enter_guess);
 465   5                                      }
 466   4                              }
 467   3                              else if(mynum==CLEAN)   //«ö¤U²M°£Áä
 468   3                              {
 469   4                                      //enter_cnt¤£¬°0«h´î1
 470   4                                      enter_cnt=(enter_cnt?enter_cnt-1:0);
 471   4                              }
 472   3                              else if(mynum == UP)    //¦V¤W¬d¬Ý¬ö¿ý
 473   3                              {
 474   4                                      display_num = (display_num +record_cnt)%(record_cnt+1);
 475   4                              }
 476   3                              else if(mynum == DOWN)  //¦V¤U¬d¬Ý¬ö¿ý
 477   3                              {
 478   4                                      display_num = (display_num+1)%(record_cnt+1);
 479   4                              }       
 480   3                              //«ö¤Uªº¬O¼Æ¦r¡A¥B¿é¤Jªº¬O±b¸¹¸¹½X
 481   3                              else if(state==Logout&&enter_cnt<8)     
 482   3                              {
 483   4                                      enter_account[enter_cnt++]=mynum;
 484   4                              }
 485   3                              //«ö¤Uªº¬O¼Æ¦r¡A¥B¿é¤Jªº¬O²q´ú¼Æ¦r
 486   3                              else if(game_start&&enter_cnt<4)
 487   3                              {
C51 COMPILER V7.08   FINAL_PROJECT                                                         05/30/2023 04:27:23 PAGE 9   

 488   4                                      show_result_flag = 0;
 489   4                                      enter_guess[enter_cnt++]=mynum;
 490   4                              }
 491   3                      }
 492   2                      
 493   2                      if(com_flag)    //ESP32¶Ç¨Ó«ü¥O
 494   2                      {
 495   3                              switch(command)
 496   3                              {
 497   4                                      case Error:
 498   4                                              //¼½©ñ­µ®Ä
 499   4                                              play_song(command);
 500   4                                              break;
 501   4                                      case Win:
 502   4                                              //¼½©ñ­µ®Ä¥B©I¥s¹CÀ¸µ²§ô³B²z¨ç¦¡
 503   4                                              play_song(command);
 504   4                                              game_end_init();
 505   4                                              break;
 506   4                                      case Loss:
 507   4                                              //¼½©ñ­µ®Ä¥B©I¥s¹CÀ¸µ²§ô³B²z¨ç¦¡
 508   4                                              play_song(command);
 509   4                                              game_end_init();
 510   4                                              break;
 511   4                                      case Wrong:
 512   4                                              //¼½©ñ­µ®Ä
 513   4                                              play_song(command);                     
 514   4                                              break;
 515   4                                      case Start:
 516   4                                              //¼½©ñ­µ®Ä¥B³]©w¹CÀ¸¶}©l
 517   4                                              play_song(command);
 518   4                                              game_start = 1;
 519   4                                              enter_cnt = 0;
 520   4                                              led_all(0);
 521   4                                              break;
 522   4      
 523   4                              }
 524   3                              //³B²z§¹«á³]«ü¥Oflag³]¬°0
 525   3                              com_flag = 0;
 526   3                      }
 527   2                      //­Y±µ¦¬¨ì¤F§¹¾ãªº²q´úµ²ªG
 528   2                      if(result_flag&&head==4)
 529   2                      {
 530   3                              result_flag = 0;
 531   3                              //±Nµ²ªG¦s¨ìrecord°}¦C¤¤
 532   3                              for(i=0;i<4;i++)
 533   3                              {
 534   4                                      if(result_buf[i]=='A'||result_buf[i]=='B')
 535   4                                              result_buf[i] = result_buf[i]-'A'+10;
 536   4                                      else 
 537   4                                              result_buf[i] = result_buf[i]-'0';
 538   4                                      record_arr[record_cnt][i]=result_buf[i];
 539   4                                      record_arr[record_cnt][i+4]=enter_guess[i]-'0';
 540   4                              }
 541   3                              show_result_flag= 1;
 542   3                              record_cnt+=1;
 543   3                              //Ãö±¼¤@­Ó¿O
 544   3                              led_close();
 545   3                              enter_cnt = 0;
 546   3                              head = 0;
 547   3                      }
 548   2                      //­Y·í«e¬°µn¤Jª¬ºA¡A¥B«ö¤Uµn¥X«ö¶s
 549   2                      if(Logout_but==0&&state==Login)
C51 COMPILER V7.08   FINAL_PROJECT                                                         05/30/2023 04:27:23 PAGE 10  

 550   2                      {
 551   3                              ck_btn=1;
 552   3                              //ÀË¬d¬O§_ªø«ö¤F¤@¬í
 553   3                              for(i=0;i<100;i++)
 554   3                              {
 555   4                                      if(Logout_but!=0)
 556   4                                      {
 557   5                                              ck_btn=0;
 558   5                                              break;
 559   5                                      }
 560   4                                      DelayMs(10); 
 561   4                              }
 562   3                              while(ck_btn==0);//¥h§Ý¡A¸Ñ¼u¸õ
 563   3                              //­Yªø«ö¤@¬í¡A«hµn¥X
 564   3                              if(ck_btn)
 565   3                              {       
 566   4                                      //³]©wª±®a¤@µn¥X
 567   4                                      state=Logout;
 568   4                                      myaccount[8]=state;
 569   4                                      //¼g¤Jeeprom
 570   4                                      ISendStr(0xae,4,&myaccount,9);
 571   4                                      //¶Ç°eµn¥X°T®§µ¹ESP32
 572   4                                      UART_SendStr("quit\n");
 573   4                                      //¼½©ñµn¥X­µ®Ä
 574   4                                      play_song(state);
 575   4                                      game_end_init();
 576   4                              }
 577   3                      }
 578   2                      display_set();
 579   2          }
 580   1      }
 581          
 582          unsigned char KeyScan(void)  //Áä½L±½´y¨ç¼Æ¡A¨Ï¥Î¦æ¦C³v¯Å±½´yªk
 583          {
 584   1              unsigned char Val;
 585   1              KeyPort=0xf0;//°ª¥|¦ì¸m°ª¡A§C¥|¦ì©Ô§C (¥á¥X)
 586   1              if(KeyPort!=0xf0)//ªí¥Ü¦³«öÁä«ö¤U       (read)(keyport¬°i/o)
 587   1              {
 588   2              DelayMs(10);  //¥h§Ý¡A¸Ñ¼u¸õ
 589   2                      if(KeyPort!=0xf0)
 590   2                      {           //ªí¥Ü¦³«öÁä«ö¤U
 591   3                      KeyPort=0xfe; //ÀË´ú²Ä¤@¦æ //1111 1110
 592   3                              if(KeyPort!=0xfe)
 593   3                              {
 594   4                                      Val=KeyPort&0xf0;       //«O¯d°ªªº4bit
 595   4                              Val+=0x0e;
 596   4                                      while(KeyPort!=0xfe);   //ÀË¬d¬O§_©ñ±¼
 597   4                                      DelayMs(10); //¥h§Ý
 598   4                                      while(KeyPort!=0xfe);//½T©w©ñ±¼
 599   4                              return Val;
 600   4                      }
 601   3                      KeyPort=0xfd; //ÀË´ú²Ä¤G¦æ      //1111 1101
 602   3                              if(KeyPort!=0xfd)
 603   3                              {
 604   4                                Val=KeyPort&0xf0;
 605   4                            Val+=0x0d;
 606   4                                while(KeyPort!=0xfd);
 607   4                                DelayMs(10); //¥h§Ý
 608   4                                while(KeyPort!=0xfd);
 609   4                        return Val;
 610   4                      }
 611   3                      KeyPort=0xfb; //ÀË´ú²Ä¤T¦æ      //1111 1011
C51 COMPILER V7.08   FINAL_PROJECT                                                         05/30/2023 04:27:23 PAGE 11  

 612   3                              if(KeyPort!=0xfb)
 613   3                              {
 614   4                                Val=KeyPort&0xf0;
 615   4                            Val+=0x0b;
 616   4                                while(KeyPort!=0xfb);
 617   4                                DelayMs(10); //¥h§Ý
 618   4                                while(KeyPort!=0xfb);
 619   4                        return Val;
 620   4                      }
 621   3                      KeyPort=0xf7; //ÀË´ú²Ä¥|¦æ      //1111 0111
 622   3                              if(KeyPort!=0xf7)
 623   3                              {
 624   4                                Val=KeyPort&0xf0;
 625   4                            Val+=0x07;
 626   4                                while(KeyPort!=0xf7);
 627   4                                DelayMs(10); //¥h§Ý
 628   4                                while(KeyPort!=0xf7);
 629   4                        return Val;
 630   4                      }
 631   3              }
 632   2              }
 633   1              return 0xff;
 634   1      }
 635          
 636          unsigned char KeyPro(void)
 637          {
 638   1              //«ö¤U¬ÛÀ³ªºÁäÅã¥Ü¬Û¹ïÀ³ªº½X­È
 639   1              switch(KeyScan())
 640   1              {
 641   2                      case 0x7e:return '1';break;     //0111 1110
 642   2                      case 0x7d:return '4';break;     //0111 1101
 643   2                      case 0x7b:return '7';break;     //0111 1011
 644   2                      case 0x77:return '0';break;     //0111 0111
 645   2                      case 0xbe:return '2';break;     //1011 1110
 646   2                      case 0xbd:return '5';break;     
 647   2                      case 0xbb:return '8';break;     
 648   2                      case 0xb7:return 0xff;break;
 649   2                      case 0xde:return '3';break;     
 650   2                      case 0xdd:return '6';break;     
 651   2                      case 0xdb:return '9';break;
 652   2                      case 0xd7:return 0xff;break;
 653   2                      case 0xee:return UP;break;      
 654   2                      case 0xed:return DOWN;break;
 655   2                      case 0xeb:return CLEAN;break;
 656   2                      case 0xe7:return ENTER;break;
 657   2                      default:return 0xff;break;
 658   2              }
 659   1      }
 660          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1879    ----
   CONSTANT SIZE    =    166    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     75       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
